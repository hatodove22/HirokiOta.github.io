# SDD Steering — 2025-09-28

コンテキスト
- 目的: /admin で GitHub ログイン画面を表示し、クリックで一時的に Proto UI（外部、5174）へ遷移させる。
- 実施: `public/admin/*` の初期化ロジックを簡素化。`local_backend: false` で自動コレクション遷移を停止。想定外の内製編集UI（/edit-proto）は撤去。
- 検証: ヘッドレス（Puppeteer）で /admin ログイン表示とクリック後の遷移を確認。`tmp/admin-debug/admin-login.json` に記録。

決定事項（Decision）
- /admin からの一時遷移先は `localStorage.proto_url`（既定: `http://localhost:5174`）。
- アプリ本体に編集UIを埋めない（/edit-proto 廃止）。編集は外部 Proto or 将来の正式画面で行う。
- Decap CMS は YAML ベースでのみ初期化（dev バイパス・自動ハッシュ遷移を無効化）。

学び（Learnings）
- Decap の `local_backend: true` は学習/検証には便利だが、想定外の自動遷移を誘発しやすい。
- 文字化けした日本語リテラルは型や設定に波及するため、早期にUTF-8へ正規化する方が安全。
- UI 変更は iframe/外側スクロールの二重化が起きやすいので、`body { overflow: hidden }` 等で必ず制御。

リスク/懸念（Risks）
- 現状は「擬似ログイン→Proto へ遷移」という暫定仕様。正式な GitHub 認証（AuthDesign.md）と乖離。
- Decap `config.yml` と `src/lib/types.ts` のフィールド定義に差分あり（多言語/必須項目）。
- CMSのログインボタン検出は文言に依存。UI 変更で壊れる可能性。

次アクション（Next Moves）
1) 認証フローの実装（M4）
   - 受入: /admin → OAuth → コールバック → CMS で write 権限ユーザーのみ編集可能。
   - タスク: `AuthDesign.md` に沿って Functions(API) の `GET /api/auth`, `GET /api/auth/callback` をモック→実装。
2) スキーマ整合（M3/M5）
   - 受入: `public/admin/config.yml` と `src/lib/types.ts` が 1:1 で対応。日英必須/任意の一致。
   - タスク: config.yml の日本語ラベルを UTF-8 で再定義し、型へ反映。
3) プレビューの言語同期（issue-15）
   - 受入: 言語トグルとプレビューが同期（URL or 状態共有）。
4) CI 最小導入
   - 受入: PR で型チェック/ビルドが自動実行。`tmp/` は除外。

完了条件（Definition of Done）
- [ ] /admin ログイン→コールバック→CMS 画面まで手動/自動で再現可能。
- [ ] スキーマの必須/任意/型がアプリと CMS で一致。
- [ ] MCP（chrome-devtools）で主要フローを毎回確認し、`docs/TODO.md` に記録。

メモ
- 本ステアリングの要点を `docs/TODO.md` と `docs/PLAN.md` に反映すること。

